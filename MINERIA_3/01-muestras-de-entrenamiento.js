/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var madreDeDios = 
    /* color: #d63000 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.36375116070516, -13.01102885478094],
                  [-70.47739099224813, -12.699574746506775],
                  [-70.48769067486532, -12.690531644035275],
                  [-70.4973037119747, -12.690196708140181],
                  [-70.50588678082235, -12.691201514502787],
                  [-70.51309655865438, -12.683162952513861],
                  [-70.51858972271688, -12.683162952513861],
                  [-70.52305291851766, -12.695555629547627],
                  [-70.5635650034786, -12.724357896491435],
                  [-70.72321008404501, -12.963691383511662],
                  [-70.66159947045456, -13.050892678873778],
                  [-70.5421880576745, -13.076739059146773],
                  [-70.46600343744393, -13.07324635751736],
                  [-70.44645624582367, -13.0868731735352],
                  [-70.43693466779337, -13.086265883280431],
                  [-70.42813987464022, -13.086547253470474],
                  [-70.41934501633816, -13.088333174445408],
                  [-70.41247927543658, -13.093530944305783],
                  [-70.40170736977826, -13.094264189674098],
                  [-70.39763038494092, -13.089312459703839],
                  [-70.39634355540983, -13.068707723912837],
                  [-70.39522925507438, -13.062110344737611],
                  [-70.39136803979973, -13.058397124055219],
                  [-70.38948104298562, -13.053680535887993],
                  [-70.38905451144821, -13.049013267290615],
                  [-70.38521441535654, -13.04702104990503],
                  [-70.3809452721473, -13.042436686010625],
                  [-70.37961699624161, -13.031595535396994],
                  [-70.3683772575059, -13.018942327226604]]]),
            {
              "system:index": "0"
            })]),
    mining2010_2018 = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53274658203115, -13.02071023256179],
                  [-70.53205993652334, -13.027901780908525],
                  [-70.52948501586904, -13.025560369487472],
                  [-70.5299999999999, -13.022215457631905]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53360488891592, -13.037936150481135],
                  [-70.53068664550771, -13.039775740771342],
                  [-70.53008583068838, -13.035343977312673],
                  [-70.53231742858877, -13.03166471716626],
                  [-70.53592231750478, -13.032417297554522]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49163368225088, -13.04980962878468],
                  [-70.487513809204, -13.049558786546744],
                  [-70.48468139648428, -13.0458797378155],
                  [-70.48699882507314, -13.043538496484762],
                  [-70.49189117431631, -13.045461660632128]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48219230651846, -13.020208488839563],
                  [-70.47953155517568, -13.019957616597445],
                  [-70.48030403137197, -13.01795062951681],
                  [-70.48399475097646, -13.018452377810853],
                  [-70.48614051818838, -13.020877480243401]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52691009521475, -13.011427809264099],
                  [-70.52768257141103, -13.014605614930701],
                  [-70.52588012695303, -13.016194502487977],
                  [-70.5259659576415, -13.018786876109155],
                  [-70.52184608459463, -13.018954125088992],
                  [-70.52244689941396, -13.014103858849323],
                  [-70.52244689941396, -13.011093301035048],
                  [-70.52570846557607, -13.01000614617411]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.58544662475576, -13.009002614379826],
                  [-70.58776405334463, -13.010675165114147],
                  [-70.58716323852529, -13.013685728005706],
                  [-70.58441665649404, -13.013602101752342],
                  [-70.58209922790518, -13.012933090709991],
                  [-70.58021095275869, -13.010089773640335],
                  [-70.58175590515127, -13.007915450353442]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.63722398757925, -12.981027532395283],
                  [-70.63818958282461, -12.982282087863585],
                  [-70.6372883605956, -12.98353663699894],
                  [-70.6350353050231, -12.98353663699894],
                  [-70.63385513305654, -12.981132078926182],
                  [-70.63514259338369, -12.980274796074728]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.59608364637413, -12.991796327232215],
                  [-70.59698486860313, -12.994932568069245],
                  [-70.59835815961875, -12.997692427235094],
                  [-70.59715652998008, -12.999281423138553],
                  [-70.59509659345665, -12.995141649383216],
                  [-70.59406662519493, -12.99351081046489]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52509302677036, -13.024754049471479],
                  [-70.52414888919712, -13.027513576729843],
                  [-70.5231189209354, -13.027053657655433],
                  [-70.52303309024693, -13.023750577390897],
                  [-70.52440638126255, -13.020572888985237],
                  [-70.52633757175327, -13.021618185722552],
                  [-70.52646631778599, -13.023834200219556]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53603643955113, -13.01693522196513],
                  [-70.53543562473179, -13.014677332821002],
                  [-70.53706640781284, -13.011583155036245],
                  [-70.54032797397495, -13.013757446162144],
                  [-70.53861136020542, -13.016098969124778]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47164690275486, -13.01955127004507],
                  [-70.47061693449314, -13.020805630772701],
                  [-70.4696727969199, -13.022728971554244],
                  [-70.46735536833103, -13.022979840990121],
                  [-70.46409380216892, -13.021641867729796],
                  [-70.46478044767673, -13.019718518508983],
                  [-70.46632540006931, -13.019969390993179],
                  [-70.46881449003513, -13.019300397137526],
                  [-70.47061693449314, -13.017878779197435]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47916325692177, -13.027269458820337],
                  [-70.47821911934852, -13.033122905456944],
                  [-70.47083768013954, -13.028691022869415],
                  [-70.47100934151649, -13.023757324420865]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48989209298134, -13.020746883871531],
                  [-70.49263867501259, -13.014642267143262],
                  [-70.49581441048622, -13.016565655761939],
                  [-70.49650105599403, -13.022586601887559]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48585805062294, -13.035547864229736],
                  [-70.48577221993446, -13.04031409325325],
                  [-70.48293980721473, -13.041484731950126],
                  [-70.48302563790321, -13.037638326859234],
                  [-70.48053654793739, -13.03604957687138],
                  [-70.48010739449501, -13.034377197443755]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53718480233192, -13.023673701566267],
                  [-70.53658398751259, -13.031283265712457],
                  [-70.53340825203895, -13.030447061309241],
                  [-70.53426655892372, -13.020412388219082],
                  [-70.5321207917118, -13.018154530754204],
                  [-70.5346957123661, -13.015394899249761],
                  [-70.53709897164345, -13.020830507714072]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52731427315712, -13.034628055078349],
                  [-70.52671345833778, -13.038892595959663],
                  [-70.52418144647994, -13.043533331365433],
                  [-70.5201581151381, -13.040930713679694],
                  [-70.51782191587363, -13.03722799685042],
                  [-70.51909061861396, -13.034863169770091],
                  [-70.52162799284378, -13.03481616163023],
                  [-70.52491101387977, -13.03529700752749],
                  [-70.52714261178016, -13.033541003492134]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52095714945855, -13.012706388076174],
                  [-70.51898304362359, -13.022156010307496],
                  [-70.51348987956109, -13.01412803568317]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52009884316081, -13.02959837620865],
                  [-70.52078548959679, -13.033026812696981],
                  [-70.51821056546297, -13.03361215076679],
                  [-70.51786724224544, -13.031270790183099]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48035923380914, -13.04230842502282],
                  [-70.48164669413629, -13.045402218890775],
                  [-70.48327747721734, -13.046990908808917],
                  [-70.48018757243219, -13.048245130481106],
                  [-70.47778431315484, -13.045820296174652]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50619427104058, -13.01805843075351],
                  [-70.50525013346734, -13.021152527702728],
                  [-70.50336185832086, -13.019061925889156]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.4922038688189, -13.022490503605837],
                  [-70.49134556193414, -13.027173362355489],
                  [-70.48756901164117, -13.02616990007697],
                  [-70.48756901164117, -13.021821516557528]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.31362551998988, -13.078027611598744],
                  [-70.31268138241664, -13.076773541181113],
                  [-70.31276721310512, -13.075310450968919],
                  [-70.31242389035121, -13.07443259267646],
                  [-70.31109351467983, -13.074265381218977],
                  [-70.31019229245082, -13.072091621959364],
                  [-70.31100768399135, -13.071757195758156],
                  [-70.31289595913783, -13.07351292825788],
                  [-70.31396884274379, -13.074683409650197],
                  [-70.31371135067836, -13.07673173872404],
                  [-70.31418341946498, -13.077985809354221],
                  [-70.31517047238246, -13.079365279682696]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.30096549343959, -13.082500410822517],
                  [-70.3010942394723, -13.083796253383365],
                  [-70.29972094845668, -13.083587246979407],
                  [-70.2996351177682, -13.082375006342282]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.30354041409389, -13.08780914197486],
                  [-70.30315417599574, -13.090651565195612],
                  [-70.30255336117641, -13.089397558992774],
                  [-70.30293959927455, -13.08847795038817]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.33638138127223, -13.075864336141422],
                  [-70.33543724369899, -13.075864336141422],
                  [-70.33462185215846, -13.075195493513142],
                  [-70.33655304264919, -13.075070085318453]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.361014788865, -13.067294652766204],
                  [-70.36208767247096, -13.06817253645108],
                  [-70.36019939732448, -13.067963516809298]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.30123371434108, -13.088028594935553],
                  [-70.3008045608987, -13.089449809378635],
                  [-70.30020374607936, -13.088739203181632]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.30861515355006, -13.08159122689569],
                  [-70.30874389958278, -13.083890306207342],
                  [-70.30707020115749, -13.084182914763566],
                  [-70.30698437046901, -13.082928875648763]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.33389229130641, -13.070680758345867],
                  [-70.33427852940456, -13.073397969964535],
                  [-70.33324856114284, -13.0729381362555],
                  [-70.33316273045436, -13.071098792850062]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.32563108754054, -13.094110499222655],
                  [-70.32588857960597, -13.094821089927644],
                  [-70.32565254521266, -13.0952390835024],
                  [-70.32526630711452, -13.094653892299123]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.645016955722, -12.976283994991437],
                  [-70.64772062240901, -12.977705851175584],
                  [-70.64651899277034, -12.979378612746101],
                  [-70.64523153244319, -12.978625871432254]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.64304284988704, -12.97523850731578],
                  [-70.6400816911346, -12.972896598971824],
                  [-70.64192705093684, -12.97306387887061],
                  [-70.64295701919856, -12.974109375688869]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.62424592911067, -12.980256808064713],
                  [-70.6261771196014, -12.979587707150994],
                  [-70.62682084976497, -12.98034044555228],
                  [-70.62583379684749, -12.980591357846157],
                  [-70.6261771196014, -12.981887733996043]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5941193574554, -12.983853194615675],
                  [-70.59506349502864, -12.985107735819287],
                  [-70.59476308761897, -12.989373128528118]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.44277322872783, -13.029977170096691],
                  [-70.44294489010478, -13.02822112832423],
                  [-70.44586313351299, -13.027217670291382]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.38681161984111, -13.020276974255337],
                  [-70.38912904842998, -13.022702058829347],
                  [-70.38621080502178, -13.022952928292487]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.39041650875713, -13.027886642765093],
                  [-70.38921487911846, -13.030478894029812],
                  [-70.38535249813701, -13.031147857692314],
                  [-70.38818491085674, -13.029057340245323]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55511190483965, -12.74991281767064],
                  [-70.56352331231035, -12.755940177804009],
                  [-70.56215002129473, -12.759121226675289],
                  [-70.55708601067461, -12.761297710755777],
                  [-70.55159284661211, -12.757698130807515],
                  [-70.55133535454668, -12.751168529532325]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53537084649004, -12.7478199507298],
                  [-70.5321951110164, -12.746061929133587],
                  [-70.53511335442461, -12.744471327651372],
                  [-70.53691579888262, -12.744973623935294]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5417223174373, -12.765399495237574],
                  [-70.54120733330645, -12.76221852530695],
                  [-70.54300977776445, -12.762134815031716]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.57510446192126, -12.806563838867953],
                  [-70.57441781641344, -12.809827944627598],
                  [-70.57149957300524, -12.809911639091162],
                  [-70.57124208093981, -12.808070354471731]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55244516016344, -12.794260291152066],
                  [-70.55476258875231, -12.796436472535362],
                  [-70.55235932947497, -12.797273460376484]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.56849549890856, -12.785053162257293],
                  [-70.57012628198962, -12.788903457016543],
                  [-70.56755136133532, -12.787899037958233]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55021356226305, -12.747300425970664],
                  [-70.54609368921618, -12.746212126093782],
                  [-70.54720948816637, -12.741858879829046],
                  [-70.55201600672106, -12.743868079708108]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5599124300609, -12.790995983884054],
                  [-70.56205819727282, -12.79250259248575],
                  [-70.56162904383044, -12.796603870325756],
                  [-70.55965493799548, -12.797273460376484],
                  [-70.56016992212633, -12.79417659149323]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55982659937243, -12.82246549371597],
                  [-70.56051324488024, -12.826566283934122],
                  [-70.55879663111071, -12.826733661707417]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.59261392237048, -12.898612105127887],
                  [-70.59415887476305, -12.904970555845054],
                  [-70.59021066309313, -12.902627987544307]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.68912882349088, -12.96704060832394],
                  [-70.68191904565884, -12.966706040313388],
                  [-70.68415064355924, -12.964029480035583]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49832720300748, -13.007605674057904],
                  [-70.50012964746549, -13.010114510061417],
                  [-70.49884218713834, -13.014212220945671],
                  [-70.49455065271451, -13.012205187341932]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.58309409853972, -12.912488368605107],
                  [-70.57433936831511, -12.906799407146444],
                  [-70.58618400332487, -12.90696673139015],
                  [-70.58961723086394, -12.911986406625827]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.60060355898894, -12.930725636444006],
                  [-70.5988869452194, -12.926375583429325],
                  [-70.6014618658737, -12.926710205583513],
                  [-70.60266349551237, -12.930892944661203]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.60918662783659, -12.937250573783782],
                  [-70.61021659609831, -12.940596629290466],
                  [-70.60678336855925, -12.941265835004174]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5561865476966, -12.775536898788307],
                  [-70.55635820907355, -12.778131766868942],
                  [-70.55438410323859, -12.778633996322387],
                  [-70.55146585983039, -12.777043599628085],
                  [-70.55292498153449, -12.775620604626221]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55704485458136, -12.765575706142325],
                  [-70.55721651595832, -12.767752134683603],
                  [-70.5539549497962, -12.767835843099547],
                  [-70.55301081222296, -12.766245378457858],
                  [-70.55446993392707, -12.765073450741916]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53404223006964, -12.771016742368566],
                  [-70.53447138351203, -12.774699838884136],
                  [-70.53266893905402, -12.774616132741228],
                  [-70.53241144698859, -12.773276830683834],
                  [-70.53146730941535, -12.771602693131545]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53369890731574, -12.778131766868942],
                  [-70.53301226180793, -12.780056974351501],
                  [-70.53043734115363, -12.779638452233845],
                  [-70.53335558456183, -12.777294715561197]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "55"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52631746810675, -12.798638657158614],
                  [-70.52846323531867, -12.79964303346556],
                  [-70.52751909774543, -12.801316985088208],
                  [-70.52494417709113, -12.80089849822428],
                  [-70.52442919296027, -12.799308241807665]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "56"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5356730131507, -12.785162888344377],
                  [-70.53730379623175, -12.788092464512893],
                  [-70.53352724593879, -12.789515389242208],
                  [-70.53266893905402, -12.787088042227658]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "57"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55704485458136, -12.801233287770986],
                  [-70.55970560592414, -12.803995284570309],
                  [-70.55961977523566, -12.80717572824923],
                  [-70.55610071700812, -12.803493105584568]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "58"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53902041000129, -12.821487228029989],
                  [-70.53910624068976, -12.824751140396922],
                  [-70.53687464278937, -12.82558803418632],
                  [-70.53644548934699, -12.821570918619319]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "59"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5451267727911, -12.842256366003086],
                  [-70.5480450161993, -12.844766864265566],
                  [-70.54701504793758, -12.846356833525887],
                  [-70.54495511141414, -12.844013717420195]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "60"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.57267842379207, -12.803926314749937],
                  [-70.57027516451473, -12.806520890949939],
                  [-70.56838688936824, -12.804846973877632],
                  [-70.57113347139949, -12.803089348989026]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "61"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.54126439180965, -12.834473662043964],
                  [-70.54358182039851, -12.834975779246564],
                  [-70.54177937594051, -12.83673318156023],
                  [-70.54057774630184, -12.835645267290467]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "62"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52838978853816, -12.827527604568138],
                  [-70.52959141817684, -12.828782930358207],
                  [-70.52744565096492, -12.830121937630866]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "63"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55104909029598, -12.772836172833873],
                  [-70.54881749239559, -12.776519242834086],
                  [-70.54598507967586, -12.774342889776534]]]),
            {
              "classId": 30,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "64"
            })]),
    noMining2010_2018 = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.4766327223058, -12.783405126326947],
                  [-70.47920764296009, -12.786753233911176],
                  [-70.4758602461095, -12.794370013236573],
                  [-70.46950877516224, -12.795876601692218],
                  [-70.46410144178822, -12.791775312030266],
                  [-70.46873629896595, -12.785665103816118]]]),
            {
              "classId": 27,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48607409803822, -12.78558140130687],
                  [-70.48547328321888, -12.787506551998844],
                  [-70.48307002394154, -12.787422850100121],
                  [-70.48264087049915, -12.785665103816118],
                  [-70.48418582289173, -12.784074751395442]]]),
            {
              "classId": 27,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48585440719538, -12.802346366350772],
                  [-70.48928763473444, -12.802095275340802],
                  [-70.48971678817682, -12.804857262697276],
                  [-70.48748519027643, -12.806196397189757]]]),
            {
              "classId": 27,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47005955469807, -12.86534767500375],
                  [-70.46963040125569, -12.869029391898144],
                  [-70.46293560755451, -12.869029391898144],
                  [-70.46250645411213, -12.865515026944019]]]),
            {
              "classId": 27,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.45255009424885, -12.863590472890873],
                  [-70.4509193111678, -12.869280416081999],
                  [-70.444653670909, -12.869196741381955],
                  [-70.44439617884358, -12.863255766331124],
                  [-70.44808689844807, -12.861749581287036]]]),
            {
              "classId": 27,
              "year": "2010,2011,2012,2013,2014,2015,2016,2017,2018",
              "system:index": "4"
            })]),
    miningMdd = 
    /* color: #d63000 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50346362349508, -13.042392441845948],
                  [-70.50346362349508, -13.044064767093575],
                  [-70.50226199385641, -13.043981151099763],
                  [-70.50123202559469, -13.042810524217948]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55543410536764, -13.005928883018209],
                  [-70.5562924122524, -13.00718331267294],
                  [-70.55466162917135, -13.00764326862345]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55758351421811, -13.017437718082949],
                  [-70.55827015972592, -13.01957014573011],
                  [-70.55741185284116, -13.01957014573011]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52830442127556, -13.024694449565503],
                  [-70.52920564350457, -13.026366894401173],
                  [-70.528561913341, -13.026408705377362]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52607282337517, -13.011565365443353],
                  [-70.52568658527703, -13.013237898891143],
                  [-70.52499993976922, -13.012527073554457]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49764154423221, -13.039463638018383],
                  [-70.49910066593631, -13.039254594092368],
                  [-70.49961565006717, -13.040425237802953],
                  [-70.49845693577274, -13.040007151399369],
                  [-70.49768445957645, -13.040885132030782]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49899833685714, -13.029525772131628],
                  [-70.49959915167648, -13.030863702799845],
                  [-70.49869792944747, -13.031741715871389],
                  [-70.49818294531661, -13.031156374169697]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49773083297983, -13.036402842635624],
                  [-70.4974733409144, -13.038367871215817],
                  [-70.49652920334115, -13.037866163274625]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.53012013432144, -13.010864537102087],
                  [-70.52900433537124, -13.011993501608035],
                  [-70.52930474278091, -13.00990282254266]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55827260014175, -12.999658240383054],
                  [-70.55681347843765, -13.000661809977828],
                  [-70.55737137791274, -12.998738298022873]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.59195973104194, -12.995016678224374],
                  [-70.59178806966499, -12.995978450484854],
                  [-70.59015728658393, -12.997483825673118],
                  [-70.58951355642036, -12.9970238508897],
                  [-70.59092976278022, -12.995393024335247]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52451888621383, -13.009807196035986],
                  [-70.52473346293502, -13.01164699525379],
                  [-70.52383224070601, -13.010936165356023]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.54640571177535, -13.00629481417281],
                  [-70.54700652659469, -13.007214728516132],
                  [-70.54709235728316, -13.007925569081008],
                  [-70.54619113505416, -13.007507427818986]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.59336890090988, -12.991625121088672],
                  [-70.5938409696965, -12.993130522671942],
                  [-70.59341181625412, -12.9948031803938],
                  [-70.59302557815597, -12.99505407808019],
                  [-70.5920385252385, -12.994259567870165],
                  [-70.59225310195968, -12.992712356480911]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55380095352218, -13.009563896107764],
                  [-70.5524705778508, -13.00952208228951],
                  [-70.55272806991623, -13.008978502010644],
                  [-70.55380095352218, -13.008978502010644]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55732001174972, -13.010860120976528],
                  [-70.55804957260177, -13.01161276456506],
                  [-70.55779208053634, -13.012114525688164],
                  [-70.55671919693039, -13.011320070107653]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50074249045984, -13.024604181794404],
                  [-70.50138622062342, -13.025273161327696],
                  [-70.50057082908289, -13.025524028186828]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48049376370548, -13.023040846669598],
                  [-70.4811804092133, -13.023584396108573],
                  [-70.48169539334415, -13.024378812373905],
                  [-70.48057959439396, -13.024127944354838]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.58961515005069, -13.000735379797717],
                  [-70.58931474264102, -13.002157096021504],
                  [-70.58888558919864, -13.001488054107327]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.61261777456241, -12.982126872711294],
                  [-70.61326150472598, -12.983130513153064],
                  [-70.61304692800479, -12.983966877091605],
                  [-70.61231736715274, -12.982921421728618]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47839333737271, -13.048139327377747],
                  [-70.47929455960171, -13.049142700563676],
                  [-70.47882249081509, -13.05006245573988],
                  [-70.47822167599575, -13.04947715738734]]]),
            {
              "classId": 30,
              "year": "all",
              "system:index": "20"
            })]),
    noMiningMdd = /* color: #ffb34b */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.58172504008346, -12.990572114532451],
                  [-70.58112422526412, -12.989150331963275],
                  [-70.58271209300094, -12.989359418145632]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.52490523378891, -12.979155777130725],
                  [-70.52563478433339, -12.980075779015737],
                  [-70.52451900115864, -12.981079413558529],
                  [-70.52241604642789, -12.981037673832457],
                  [-70.52078519126724, -12.979887550904836]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.54917642330285, -12.991230297734406],
                  [-70.55003473018762, -12.992233901399546],
                  [-70.54879018520471, -12.993028418091287],
                  [-70.54715940212365, -12.99240116828275]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5084179350528, -13.000879914599574],
                  [-70.50326809374421, -13.002636150081022],
                  [-70.4974316069278, -13.00221799990336],
                  [-70.49279674975007, -13.003639707632253],
                  [-70.49022182909577, -13.005897697280295],
                  [-70.48670277086823, -13.006315841255988],
                  [-70.48550114122956, -13.005061407214384],
                  [-70.48670277086823, -13.002803409954778],
                  [-70.48378452746003, -13.000545392146233],
                  [-70.48361286608308, -13.002552520101853],
                  [-70.48069462267487, -13.004308743744588],
                  [-70.47666058031648, -13.003556077991355],
                  [-70.47468647448152, -13.006901241637772],
                  [-70.47339901415437, -13.007152127092741],
                  [-70.47305569140046, -13.011333513978204],
                  [-70.4707382628116, -13.006566727303076],
                  [-70.46936497179597, -13.00581406840058],
                  [-70.46893581835359, -13.008072038256465],
                  [-70.46696171251862, -13.00857380654401],
                  [-70.46627506701081, -12.995360236463291],
                  [-70.4780338713321, -12.99159674918764],
                  [-70.50026401964753, -12.988920456868929],
                  [-70.50507053820222, -12.98925499498583],
                  [-70.51039204088777, -12.993102150942912],
                  [-70.51322445360749, -13.000294500010316]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.46344265429109, -13.010748124058628],
                  [-70.46026691881745, -13.014678572718541],
                  [-70.45537456957429, -13.015096701887481],
                  [-70.45322880236237, -13.018023586320027],
                  [-70.45254215685456, -13.013424180980046],
                  [-70.44756397692292, -13.011751648788914],
                  [-70.44335827318757, -13.003806966829481],
                  [-70.45322880236237, -12.99745103807731],
                  [-70.46404346911042, -12.997200142813423],
                  [-70.46627506701081, -13.00598132613183],
                  [-70.4659317442569, -13.010413614912663]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.42902454821198, -13.01024636017045],
                  [-70.43357357470124, -13.02011419689408],
                  [-70.4340885588321, -13.02429536512193],
                  [-70.43314442125886, -13.027723870404456],
                  [-70.43134197680085, -13.031904910164755],
                  [-70.42507633654206, -13.035166072157052],
                  [-70.41306004015534, -13.034079022933899],
                  [-70.40851101366609, -13.035584166740742],
                  [-70.40473446337312, -13.04093571502],
                  [-70.39434895006745, -13.041521033590053],
                  [-70.39503559557527, -13.033911784168108],
                  [-70.41511997667878, -13.013758686064275]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5226571097431, -13.002455351743956],
                  [-70.51699232821639, -12.999110154088976],
                  [-70.51561904783527, -12.995597648020215],
                  [-70.51115588659363, -12.9910814957691],
                  [-70.5106409064196, -12.985561642567292],
                  [-70.52025386909963, -12.986063452446814],
                  [-70.53021015184319, -12.990746962710066],
                  [-70.5333000326566, -12.995430384631558]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50921167944355, -12.82325131219154],
                  [-70.5064650974123, -12.829779048842411],
                  [-70.50217356298847, -12.837980324034051],
                  [-70.49856867407246, -12.839988758817684],
                  [-70.49487795446797, -12.840072443252108],
                  [-70.49642290686054, -12.837729268557926],
                  [-70.49942698095722, -12.835386072025877],
                  [-70.50457682226582, -12.825678310976812]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48947062109394, -12.844591361336],
                  [-70.49127306555195, -12.847185518336044],
                  [-70.48844065283222, -12.850532778109757],
                  [-70.48492159460469, -12.850700139927557],
                  [-70.47882761572285, -12.84752024632048],
                  [-70.4844924411623, -12.845428189101128]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48929895971699, -12.802160544912178],
                  [-70.49015726660176, -12.804420354414908],
                  [-70.48792566870137, -12.80592688282986],
                  [-70.48543657873554, -12.802662726552079]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47136034582539, -12.8260967566778],
                  [-70.47376360510273, -12.830281175416694],
                  [-70.47239031408711, -12.83438183825657],
                  [-70.46775545690937, -12.833712346849207],
                  [-70.46895708654804, -12.82793790949609]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.4760810336916, -12.852875833409938],
                  [-70.48208918188496, -12.853461593819214],
                  [-70.4812308750002, -12.862582543858943],
                  [-70.47359194372578, -12.86157841880672]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48653106456027, -12.88243585333806],
                  [-70.48550109629855, -12.887539689306719],
                  [-70.47992210154757, -12.887205014724751],
                  [-70.47846297984347, -12.881766490087598],
                  [-70.48172454600558, -12.879758389606243]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.500349805405, -12.910296510989987],
                  [-70.49871902232394, -12.913810247431341],
                  [-70.49597244029269, -12.916989299734709],
                  [-70.49168090586886, -12.913893907220677],
                  [-70.49331168894992, -12.90502581371822],
                  [-70.50163726573214, -12.908121316058244]]]),
            {
              "classId": 27,
              "year": "all",
              "system:index": "13"
            })]),
    mining2005_2009 = 
    /* color: #ffc82d */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49769158767238, -13.039324694306488],
                  [-70.49932237075343, -13.040578954857589],
                  [-70.49915070937648, -13.043087456881027],
                  [-70.49700494216457, -13.042669374977152]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49297089980617, -13.038655752745798],
                  [-70.49297089980617, -13.041164274271813],
                  [-70.49073930190578, -13.041582358719737],
                  [-70.49022431777492, -13.03899022375223]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49340005324855, -13.029708485535558],
                  [-70.49520249770656, -13.030544692433386],
                  [-70.4946875135757, -13.032467957579572],
                  [-70.49331422256007, -13.032217097755714]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.46747918532863, -13.034223969227916],
                  [-70.46953912185207, -13.037568718852231],
                  [-70.46876664565578, -13.039408311874393],
                  [-70.46679253982082, -13.036816154128365],
                  [-70.46447511123195, -13.03480930367548]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.54515595839992, -13.027534334384358],
                  [-70.54498429702296, -13.030711933474025],
                  [-70.54146523879542, -13.029624864690447],
                  [-70.54206605361476, -13.027617955935476]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.51073785232082, -13.03890660604302],
                  [-70.50842042373195, -13.035812730936232],
                  [-70.51133866714015, -13.035227398861897],
                  [-70.51425691054835, -13.038572134923548]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.51193948195949, -13.023185974818869],
                  [-70.51331277297511, -13.02561103091549],
                  [-70.51202531264796, -13.028286927327809],
                  [-70.5097078840591, -13.027032604484695],
                  [-70.50936456130519, -13.024022203741044]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50902123855128, -13.013736391861594],
                  [-70.51022286818996, -13.015576161921967],
                  [-70.50962205337062, -13.018001292500946],
                  [-70.50584550307765, -13.015241659290263]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50378556655421, -13.042334908945223],
                  [-70.50515885756984, -13.04384000252706],
                  [-70.50438638137355, -13.046432086668172],
                  [-70.5012964765884, -13.045261471388308]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47322984145656, -13.03313691586694],
                  [-70.4756331007339, -13.036147205785689],
                  [-70.47400231765285, -13.037401482444734],
                  [-70.47091241286769, -13.034474827017812]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49073930190578, -13.033805872346392],
                  [-70.49219842360988, -13.035311017814426],
                  [-70.49116845534816, -13.037652337013604],
                  [-70.48962350295558, -13.036565298711775]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.47311306516143, -13.06007868063849],
                  [-70.47216892758819, -13.063255861558929],
                  [-70.46976566831084, -13.064844436690013],
                  [-70.46864986936065, -13.06216893584389]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5182600073001, -13.044443010854572],
                  [-70.51980495969268, -13.047954851692156],
                  [-70.51620007077666, -13.048372924659818]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.43028355161162, -13.04360685092307],
                  [-70.42976856748076, -13.04527916795891],
                  [-70.42856693784209, -13.045446399040491],
                  [-70.4277944616458, -13.043941315234928]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48864841977569, -13.053724196197027],
                  [-70.48607349912139, -13.053222519412284],
                  [-70.48573017636748, -13.051466642645817],
                  [-70.48839092771026, -13.051717482947634]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55331750227316, -13.037472149667153],
                  [-70.55185838056906, -13.037137676608587],
                  [-70.550227597488, -13.038391948246938],
                  [-70.550227597488, -13.037137676608587],
                  [-70.55151505781515, -13.035883398612375],
                  [-70.55348916365011, -13.036552347668183]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.63502831770285, -12.988968841484095],
                  [-70.63502831770285, -12.986376156307205],
                  [-70.638118222488, -12.986794333165928]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.62656906062158, -12.973535885916196],
                  [-70.62751319819482, -12.97554323211537],
                  [-70.62596824580224, -12.978136030305714],
                  [-70.62459495478662, -12.975877788239858]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.61420944148095, -12.985746991360985],
                  [-70.61249282771142, -12.984241545029642],
                  [-70.61420944148095, -12.981983358431565],
                  [-70.61592605525048, -12.985328812739446]]]),
            {
              "classId": 30,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "18"
            })]),
    noMining2005_2009 = 
    /* color: #00ffff */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.56627030776515, -13.041665975524527],
                  [-70.56300874160304, -13.039742781863419],
                  [-70.56395287917628, -13.035812730936232],
                  [-70.56687112258449, -13.037819573251552]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.44190304339115, -13.046179873994298],
                  [-70.44276135027592, -13.048521090315662],
                  [-70.44370548784916, -13.05077867077056],
                  [-70.4420747047681, -13.050360601871489],
                  [-70.44087307512943, -13.048019402970294]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.44404881060306, -13.056882396159816],
                  [-70.44404881060306, -13.060310449773425],
                  [-70.440615583064, -13.060728501837465],
                  [-70.43984310686771, -13.056882396159816]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.41263477862064, -13.073509807375178],
                  [-70.4128064399976, -13.077021234936431],
                  [-70.40954487383549, -13.07718844452594],
                  [-70.41083233416263, -13.074011442943902]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.39844036618682, -13.049543525208012],
                  [-70.39955616513701, -13.053640583470294],
                  [-70.3985261968753, -13.06049673309483],
                  [-70.39689541379424, -13.065095263408],
                  [-70.39535046140166, -13.06099839510838],
                  [-70.39251804868194, -13.057235905171458],
                  [-70.39432049313994, -13.050212437318178],
                  [-70.39689541379424, -13.048958225626786]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.43062687436553, -13.051215802089414],
                  [-70.43320179501983, -13.057068682066374],
                  [-70.43157101193877, -13.05832285259536],
                  [-70.43011189023467, -13.055312832629589],
                  [-70.4300260595462, -13.057068682066374],
                  [-70.428910260596, -13.058239241424848],
                  [-70.42496204892608, -13.056567012072028],
                  [-70.42822361508819, -13.052804454647019],
                  [-70.42959690610381, -13.050546892694475]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.63365502668722, -12.964128133172936],
                  [-70.63150925947531, -12.962957129463927],
                  [-70.63399834944113, -12.961284257466064],
                  [-70.63580079389914, -12.962622555963751]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.6238703282009, -12.939954154558361],
                  [-70.62112374616964, -12.939033991398807],
                  [-70.6230978520046, -12.936775394704195],
                  [-70.625329449905, -12.938113824844102]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5886501459101, -12.916285868672716],
                  [-70.5878776697138, -12.918586479877119],
                  [-70.58581773319037, -12.918210017675316],
                  [-70.58611814060004, -12.915825743889517]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.57276043882757, -12.9110571280629],
                  [-70.57233128538519, -12.912897657234849],
                  [-70.57022843351751, -12.912312035786753],
                  [-70.5695417880097, -12.911308110111737],
                  [-70.57130131712347, -12.91059699365214]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.58407077919058, -12.90411458673984],
                  [-70.58286914955191, -12.90440740723683],
                  [-70.58286914955191, -12.903654439551849],
                  [-70.58402786384634, -12.903654439551849]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5810667050939, -12.90411458673984],
                  [-70.58055172096304, -12.905536854513386],
                  [-70.57995090614371, -12.905662348340336],
                  [-70.57990799079947, -12.90482572163775]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.54909477363638, -12.896626631855344],
                  [-70.54806480537466, -12.899973231571726],
                  [-70.54557571540884, -12.898801926762852],
                  [-70.5475498212438, -12.895957306540808]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.51373252998404, -12.898048942204252],
                  [-70.51639328132681, -12.899805902649067],
                  [-70.51381836067252, -12.903152459835747],
                  [-70.5105567945104, -12.901479186839072]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.54252872596793, -12.861526473302392],
                  [-70.54334411750845, -12.862781629249659],
                  [-70.5431724561315, -12.86320001317019],
                  [-70.5420566571813, -12.862195890588913]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49741781520582, -12.859241680200856],
                  [-70.4989627675984, -12.865433778338238],
                  [-70.49364126491285, -12.866939941264418],
                  [-70.49243963527418, -12.86208671723871]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49158132838942, -12.949179412217235],
                  [-70.49587286281324, -12.9493467080536],
                  [-70.49484289455152, -12.953780006786712],
                  [-70.49080885219313, -12.951019660239508]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.5527786092732, -12.963921200014795],
                  [-70.55200613307692, -12.969608858667028],
                  [-70.54925955104567, -12.973874517326362],
                  [-70.54848707484938, -12.968521522211569],
                  [-70.54968870448805, -12.966095908379508]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.67280208431035, -13.019708378443205],
                  [-70.67288791499882, -13.022969701057825],
                  [-70.67074214778691, -13.023220570249919],
                  [-70.67082797847539, -13.020460995164598]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.67057048640996, -13.012683845491868],
                  [-70.66979801021367, -13.015861635057995],
                  [-70.66851054988652, -13.015025378595457],
                  [-70.6689397033289, -13.012600218900563]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.4945785617308, -12.833513512923169],
                  [-70.49329110140366, -12.838116233992322],
                  [-70.4898578738646, -12.83635884134506],
                  [-70.48968621248764, -12.834015632042743]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50298996920151, -12.827236939358318],
                  [-70.50273247713608, -12.829329147945888],
                  [-70.5000717257933, -12.829329147945888],
                  [-70.50024338717026, -12.826902184369917]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.48845627370252, -12.839767667226683],
                  [-70.48811295094862, -12.843366075913535],
                  [-70.4856238609828, -12.84437027379378],
                  [-70.4841647392787, -12.841106616012045],
                  [-70.48888542714491, -12.839181874890425]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.57965896392072, -12.97923469234591],
                  [-70.57768485808576, -12.982078362828574],
                  [-70.57553909087385, -12.980823806331937]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.62291763091291, -12.961419193166291],
                  [-70.62489173674787, -12.964179424437496],
                  [-70.62283180022443, -12.96426306733151],
                  [-70.62180183196271, -12.96208834295179]]]),
            {
              "classId": 27,
              "year": "2005,2006,2007,2008,2009",
              "system:index": "24"
            })]),
    miningMdd1990 = 
    /* color: #bf04c2 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.50634380722242, -13.021789432265134],
                  [-70.50857540512281, -13.02488348261963],
                  [-70.50737377548414, -13.025803327974778],
                  [-70.5053138389607, -13.023043781661237]]]),
            {
              "classId": 30,
              "year": "1990,",
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49424168014723, -13.033914543644894],
                  [-70.49741741562086, -13.036506731786377],
                  [-70.4943275108357, -13.039015275101557]]]),
            {
              "classId": 30,
              "year": "1990,",
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.49964901352125, -13.026137816347813],
                  [-70.4994773521443, -13.02831197976046],
                  [-70.49698826217848, -13.026305060364917]]]),
            {
              "classId": 30,
              "year": "1990,",
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-70.55689808273512, -13.02137131438842],
                  [-70.55809971237379, -13.023880011063422],
                  [-70.55646892929273, -13.024799860145224]]]),
            {
              "classId": 30,
              "year": "1990,",
              "system:index": "3"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
var param = {
  regionIds: [702, 701],                                   // Region de mosaico.
  country: 'PERU',                               // Pas.
  siteName: 'madre-de-dios',                     // Nombre de la zona minera.
  samples: null,                                 // Numero de puntos. null toma todos los pixeles disponibles.
  exportSamples: false,                          // Exportar muestras. false para ver mosaicos y tomar muestras.
  roi: {
    _geometry: madreDeDios,
    trainingPolygons: [
      miningMdd1990,                             // Muestras para 1990 nicamente.
      miningMdd, noMiningMdd,                    // Muestras para todos los aos.
      mining2005_2009, noMining2005_2009,        // Muestras para los aos 2005 a 2009.
      mining2010_2018, noMining2010_2018,        // Muestras para los aos 2010 a 2018.
    ],
  },
  previewSamples: 2015,                          // Previsualizar mustras de esta ao. Requiere exportSamples: true.
  referenceClassification: true,                 // Mostrar clasificacin de referencia.
  referenceYears: [
    1985, 1988, 1990, 1995, 2000,                // Aos de referencia para mostrar mosaicos y clasificaciones.
    2020
  ]
};




/**
 * SampleMining class
 * @param param object containing
 *    - region: number indicating the mosaic region id.
 *    - roi._geometry: name of the ROI geometry
 *    - roi.trainingPolygons: list names of the mining / no-mining geomeries
 *        used for sampling to each class.
 *    - exportSamples: bollean; if true, samples points will be saved
 *        to a featureCollection().
 * @returns ee.FeatureCollection() as task for export to asset
 */
var SampleMining = function(param) {
  
  this.inputs = {
    mosaics: 'projects/mapbiomas-raisg/MOSAICOS/workspace-c3-v2',
    samples: 'projects/mapbiomas-raisg/MUESTRAS/COLECCION3/TRANSVERSALES/MINERIA/',
    classification: {
      ecu: 'projects/mapbiomas-raisg/COLECCION3/INTEGRACION/test1/ECUADOR-CLASES-GENERALES-0',
      ven: 'users/Mosaico_Clasification/AFF/COLLECTION1/RASTERS/VENEZUELA-AFF-6',
      per: 'projects/mapbiomas-raisg/COLECCION3/INTEGRACION/test1/PERU-CLASES-GENERALES-1',
      all: 'projects/mapbiomas-raisg/SUBPRODUCTOS/ATLAS/clasificacion/clasificacion-raisg-atlas',
    },
    palette: require('users/mapbiomas/modules:Palettes.js').get('classification2'),
    years: [
      1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995,
      1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 
      2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017,
      2018, 2019, 2020
    ]
  };
  
  
  this.init = function(param) {
    
    // Set satellite as default view
    Map.setOptions({
      mapTypeId: 'SATELLITE'
    });
    
    // Inputs ands parms
    var _this = this;

    var regionIds = param.regionIds;
    var country = param.country;

    var roi = param.roi._geometry;
    var trainingPolygons = param.roi.trainingPolygons;
    var roiName = param.siteName;
    
    var exportSamples = param.exportSamples;
    var previewSamples = param.previewSamples;

    var mapbiomasClassification = param.referenceClassification;
    var referenceYears = param.referenceYears;

    var samples = _this.inputs.samples;
    var assetMosaics = _this.inputs.mosaics;
    var assetClassification = _this.inputs.classification;
    var years = _this.inputs.years;
    var palette = _this.inputs.palette;
    
    var yearMosaic, yearPolygons, yearSamples, listYears, yearDisplay = false;


    if(roi) {
        
      // Region raster
      var geometryRaster = roi
        .map(this.setVersion)
        .reduceToImage(['version'], ee.Reducer.first());
      
      var mosaic = _this.getMosaic(assetMosaics, regionIds, []);
    
    
      // Iterate by years
      
      if(exportSamples) {
        
        if(trainingPolygons.length > 0) {
          
          var polygons = ee.FeatureCollection(trainingPolygons).flatten();
          
          var allYearsPolygons = polygons.filterMetadata('year', 'equals', 'all');
          
          listYears = ee.List(years);
          
          listYears.evaluate(function(years, error) {
            
            if(error) print(error.message);
            
            var trainingSamples = years.map(function(year) {
              
              // Polygons
              var allPolygons = allYearsPolygons
                .map(function(polygon){
                  return polygon.set('year', year);
                });
              
              yearPolygons = polygons.filter(
                ee.Filter.stringContains('year', year.toString())
              )
              .map(function(polygon){
                return polygon.set('year', year);
              });
              
              var fullPolygons = allPolygons.merge(yearPolygons);
              

              var polygonsBand = fullPolygons
                .reduceToImage(['classId'], ee.Reducer.first())
                .byte()
                .rename('reference');

              // Mosaics
              yearMosaic = mosaic
                .filterMetadata('year', 'equals', year)
                .mosaic()
                .updateMask(geometryRaster)
                .addBands(polygonsBand);
              
              return _this.getSamples(yearMosaic, fullPolygons)
                .map(function(item){ return item.set('year', year) });

            });
            
            var sampleCollection = ee.FeatureCollection(trainingSamples).flatten();
            
            

            if(previewSamples) {
              
              Map.addLayer(
                sampleCollection.filterMetadata('year', 'equals', previewSamples), 
                {
                  color: 'lightblue' 
                }, 
                'MUESTRAS ' + previewSamples
              );
              
              Map.addLayer(
                sampleCollection.filterMetadata('year', 'equals', (previewSamples + 1)), 
                {
                  color: 'red' 
                }, 
                'MUESTRAS ' + (previewSamples + 1)
              );
              
            }

            
            // Export samples to asset
            roiName = roiName.split(' ').join('-').toUpperCase();
            var fullRegion = regionIds.join('-')
            var fileName = "mineria-" + fullRegion + "-" + country + '-' + roiName;
            var fullRoiName = "roi-" + fullRegion + "-" + country + '-' + roiName;
            
            var miningId = samples + fileName;
            var roiId = samples + fullRoiName;
            
            Export.table.toAsset(sampleCollection, fileName, miningId);
            Export.table.toAsset(roi, fullRoiName, roiId);
            
          });
            
        }
        
        else {
          print(
            'ERROR: no hay muestras disponibles ',
            'para exportar'
          );
          print(
            'INSTRUCCIN: dibuje puntos o polgonos ',
            'de minera y no-minera en su rea de inters.',
            'Luego asigne esas geometras en el parmetro',
            'roi.trainingPolygons.'
          );
        }
          
      }
      
      else {
        
        if(trainingPolygons.length === 0) {
          
          print(
            'NOTA: aun no ha dibujado ninguna geometra',
            'INSTRUCCIN: dibuje puntos o polgonos ',
            'de minera y no-minera en su rea de inters.',
            'Luego asigne esas geometras en el parmetro',
            'roi.trainingPolygons.'
          );
          
        }
          
        listYears = ee.List(referenceYears);
        
        listYears.evaluate(function(years, error) {
          var path = assetClassification;
          
          if(country === 'ECUADOR') path = path.ecu;
          else if(country === 'VENEZUELA') path.ven;
          else if(country === 'PERU') path = path.per;
          else path = path.all;
          
          var classification = ee.Image(path).updateMask(geometryRaster);
          
          years.forEach(function(year) {
    
            // Classification
            if(mapbiomasClassification) {
              
              var yearClassification = classification
                .select('classification_' + year);
      
              Map.addLayer(yearClassification, {
                  min: 0,
                  max: 34,
                  palette: palette
                }, 
                'COLECCION 2 ' + year, 
                false
              );
              
            }

            // Mosaics
            yearMosaic = mosaic.filterMetadata('year', 'equals', year)
              .mosaic()
              .updateMask(geometryRaster);
            
            if(year === years[years.length - 1]) yearDisplay = true;
            
            Map.addLayer(yearMosaic, {
                bands: ['swir1_median', 'nir_median', 'red_median'],
                gain: [0.08, 0.06, 0.2]
              }, 
              'MOSAICO ' + year, 
              yearDisplay
            );
    
          });
          
          var styledRoi = roi.style({
            color: '#d6ff47',
            fillColor: '#00000000',
            width: 3
          });
      
          Map.addLayer(styledRoi, {}, 'REGION OF INTEREST');
          
        });
        
      }
      
    }
    
    else {
      print(
        'INSTRUCCIN: dibuje un rea de inters ', 
        'y asgnela en el parmetro roi._gometry.'
      );
    }
    
  };
  
  
  /**
   * Get mosaics
   */
  this.getMosaic = function(path, regionIds, variables) {
  
    var mosaicRegions = ee.List(regionIds).map(function(item) {
      return ee.String(item);
    });
    
    print(mosaicRegions)
    
    var mosaics = ee.ImageCollection(path)
      .filter(
        ee.Filter.inList('region_code', mosaicRegions)
      );
    
    // Select variables
    if(variables.length > 0) {
      var rgb = ['swir1_median', 'nir_median', 'red_median'];
      variables = rgb.concat(variables);
      return mosaics.select(variables);
    }
    else return mosaics;
  
  };
  
  
  
  
  /**
   * Get samples
   */
  this.getSamples = function(mosaic, region) {
    
    var samples = mosaic.sample({
      region: region,
      scale: 30,
      numPixels: 3000,
      geometries: true,
      tileScale: 4
    });
    
    return samples
  };

  
  
  
  this.setVersion = function(item) { return item.set('version', 1)};
  
  
  
  return this.init(param);
  
};


new SampleMining(param);